import{P as B,w as f,Y as z,K as j,Q as N,y as m,z as g,R as P,S as R,B as D,J as L,N as K}from"./index.js";import{f as V}from"./chat.svelte.js";import{n as q,q as H,z as J,k as I,x as Q,I as x,c as U,B as w,e as Y}from"./MarkdownContent.svelte_svelte_type_style_lang.js";import"style-to-object";import"clsx";import{i as F,c as G,l as O,t as W}from"./settings.svelte.js";const X=H({component:"label",parts:["root"]});class S{static create(s){return new S(s)}opts;attachment;constructor(s){this.opts=s,this.attachment=q(this.opts.ref),this.onmousedown=this.onmousedown.bind(this)}onmousedown(s){s.detail>1&&s.preventDefault()}#e=B(()=>({id:this.opts.id.current,[X.root]:"",onmousedown:this.onmousedown,...this.attachment}));get props(){return this.#e()}set props(s){return this.#e(s)}}function Z(u,s){f();const c=z(u);let{children:o,child:n,id:d=J(c),ref:i=null,for:a,$$slots:v,$$events:h,...p}=s;const r=S.create({id:I.with(()=>d),ref:I.with(()=>i,k=>i=k)}),l=Q(p,r.props,{for:a});n?(u.out.push("<!--[-->"),n(u,{props:l}),u.out.push("<!---->")):(u.out.push("<!--[!-->"),u.out.push(`<label${j({...l,for:a},null)}>`),o?.(u),u.out.push("<!----></label>")),u.out.push("<!--]-->"),N(s,{ref:i}),m()}function y(u,s){f();let{$$slots:c,$$events:o,...n}=s;x(u,g([{name:"circle-check-big"},n,{iconNode:[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335"}],["path",{d:"m9 11 3 3L22 4"}]],children:i=>{n.children?.(i),i.out.push("<!---->")},$$slots:{default:!0}}])),m()}function $(u,s){f();let{$$slots:c,$$events:o,...n}=s;x(u,g([{name:"circle-x"},n,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m15 9-6 6"}],["path",{d:"m9 9 6 6"}]],children:i=>{n.children?.(i),i.out.push("<!---->")},$$slots:{default:!0}}])),m()}function ee(u,s){f();let{$$slots:c,$$events:o,...n}=s;x(u,g([{name:"key"},n,{iconNode:[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4"}],["path",{d:"m21 2-9.6 9.6"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5"}]],children:i=>{n.children?.(i),i.out.push("<!---->")},$$slots:{default:!0}}])),m()}function b(u,s){f();let{$$slots:c,$$events:o,...n}=s;x(u,g([{name:"refresh-cw"},n,{iconNode:[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]],children:i=>{n.children?.(i),i.out.push("<!---->")},$$slots:{default:!0}}])),m()}function te(u,s){f();let{$$slots:c,$$events:o,...n}=s;x(u,g([{name:"triangle-alert"},n,{iconNode:[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]],children:i=>{n.children?.(i),i.out.push("<!---->")},$$slots:{default:!0}}])),m()}function se(u,s){f();let{ref:c=null,class:o,$$slots:n,$$events:d,...i}=s,a=!0,v;function h(p){p.out.push("<!---->"),Z(p,g([{"data-slot":"label",class:U("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",o)},i,{get ref(){return c},set ref(r){c=r,a=!1}}])),p.out.push("<!---->")}do a=!0,v=P(u),h(v);while(!a);R(u,v),N(s,{ref:c}),m()}function le(u,s){f();let{class:c="",error:o,onRetry:n,showRetry:d=!0,showTroubleshooting:i=!1}=s,a=F(),v=o.toLowerCase().includes("access denied")||o.toLowerCase().includes("invalid api key")||o.toLowerCase().includes("unauthorized")||o.toLowerCase().includes("401")||o.toLowerCase().includes("403"),h="",p=!1,r="idle",l="";function k(){n?n():O.fetchServerProps()}function E(){p=!0,h=G().apiKey?.toString()||""}async function _(){if(h.trim()){r="validating",l="";try{W("apiKey",h.trim());const e=await fetch("./props",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${h.trim()}`}});e.ok?(r="success",setTimeout(()=>{V("#/")},1e3)):(r="error",e.status===401||e.status===403?l="Invalid API key - please check and try again":l=`Authentication failed (${e.status})`,setTimeout(()=>{r="idle"},3e3))}catch(e){r="error",e instanceof Error?e.message.includes("fetch")?l="Cannot connect to server - check if server is running":l=e.message:l="Connection error - please try again",setTimeout(()=>{r="idle"},3e3)}}}function T(e){e.key==="Enter"&&_()}let C=!0,A;function M(e){e.out.push(`<div${D(`flex h-full items-center justify-center ${K(c)}`)}><div class="w-full max-w-md px-4 text-center"><div class="mb-6"><div class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-destructive/10">`),te(e,{class:"h-8 w-8 text-destructive"}),e.out.push(`<!----></div> <h2 class="mb-2 text-xl font-semibold">Server Connection Error</h2> <p class="mb-4 text-sm text-muted-foreground">${L(o)}</p></div> `),v&&!p?(e.out.push("<!--[-->"),e.out.push('<div class="mb-4">'),w(e,{onclick:E,variant:"outline",class:"w-full",children:t=>{ee(t,{class:"h-4 w-4"}),t.out.push("<!----> Enter API Key")},$$slots:{default:!0}}),e.out.push("<!----></div>")):e.out.push("<!--[!-->"),e.out.push("<!--]--> "),p?(e.out.push("<!--[-->"),e.out.push('<div class="mb-4 space-y-3 text-left"><div class="space-y-2">'),se(e,{for:"api-key-input",class:"text-sm font-medium",children:t=>{t.out.push("<!---->API Key")},$$slots:{default:!0}}),e.out.push('<!----> <div class="relative">'),Y(e,{id:"api-key-input",placeholder:"Enter your API key...",onkeydown:T,class:`w-full pr-10 ${K(r==="error"?"border-destructive":r==="success"?"border-green-500":"")}`,disabled:r==="validating",get value(){return h},set value(t){h=t,C=!1}}),e.out.push("<!----> "),r==="validating"?(e.out.push("<!--[-->"),e.out.push('<div class="absolute top-1/2 right-3 -translate-y-1/2">'),b(e,{class:"h-4 w-4 animate-spin text-muted-foreground"}),e.out.push("<!----></div>")):(e.out.push("<!--[!-->"),r==="success"?(e.out.push("<!--[-->"),e.out.push('<div class="absolute top-1/2 right-3 -translate-y-1/2">'),y(e,{class:"h-4 w-4 text-green-500"}),e.out.push("<!----></div>")):(e.out.push("<!--[!-->"),r==="error"?(e.out.push("<!--[-->"),e.out.push('<div class="absolute top-1/2 right-3 -translate-y-1/2">'),$(e,{class:"h-4 w-4 text-destructive"}),e.out.push("<!----></div>")):e.out.push("<!--[!-->"),e.out.push("<!--]-->")),e.out.push("<!--]-->")),e.out.push("<!--]--></div> "),l?(e.out.push("<!--[-->"),e.out.push(`<p class="text-sm text-destructive">${L(l)}</p>`)):e.out.push("<!--[!-->"),e.out.push("<!--]--> "),r==="success"?(e.out.push("<!--[-->"),e.out.push('<p class="text-sm text-green-600">âœ“ API key validated successfully! Connecting...</p>')):e.out.push("<!--[!-->"),e.out.push('<!--]--></div> <div class="flex gap-2">'),w(e,{onclick:_,disabled:!h.trim()||r==="validating"||r==="success",class:"flex-1",children:t=>{r==="validating"?(t.out.push("<!--[-->"),b(t,{class:"h-4 w-4 animate-spin"}),t.out.push("<!----> Validating...")):(t.out.push("<!--[!-->"),r==="success"?(t.out.push("<!--[-->"),t.out.push("Success!")):(t.out.push("<!--[!-->"),t.out.push("Save &amp; Retry")),t.out.push("<!--]-->")),t.out.push("<!--]-->")},$$slots:{default:!0}}),e.out.push("<!----> "),w(e,{onclick:()=>{p=!1,r="idle",l=""},variant:"outline",class:"flex-1",disabled:r==="validating",children:t=>{t.out.push("<!---->Cancel")},$$slots:{default:!0}}),e.out.push("<!----></div></div>")):e.out.push("<!--[!-->"),e.out.push("<!--]--> "),d?(e.out.push("<!--[-->"),e.out.push("<div>"),w(e,{onclick:k,disabled:a,class:"w-full",children:t=>{a?(t.out.push("<!--[-->"),b(t,{class:"h-4 w-4 animate-spin"}),t.out.push("<!----> Connecting...")):(t.out.push("<!--[!-->"),b(t,{class:"h-4 w-4"}),t.out.push("<!----> Retry Connection")),t.out.push("<!--]-->")},$$slots:{default:!0}}),e.out.push("<!----></div>")):e.out.push("<!--[!-->"),e.out.push("<!--]--> "),i?(e.out.push("<!--[-->"),e.out.push('<div class="mt-4 text-left"><details class="text-sm"><summary class="cursor-pointer text-muted-foreground hover:text-foreground">Troubleshooting</summary> <div class="mt-2 space-y-3 text-xs text-muted-foreground"><div class="space-y-2"><p class="mb-4 font-medium">Start the Delta server:</p> <div class="rounded bg-muted/50 px-2 py-1 font-mono text-xs"><p>delta server</p></div> <p>or</p> <div class="rounded bg-muted/50 px-2 py-1 font-mono text-xs"><p class="mt-1">delta server -m locally-stored-model.gguf</p></div></div> <ul class="list-disc space-y-1 pl-4"><li>Check that the server is accessible at the correct URL</li> <li>Verify your network connection</li> <li>Check server logs for any error messages</li></ul></div></details></div>')):e.out.push("<!--[!-->"),e.out.push("<!--]--></div></div>")}do C=!0,A=P(u),M(A);while(!C);R(u,A),m()}export{se as L,b as R,le as S,te as T};
