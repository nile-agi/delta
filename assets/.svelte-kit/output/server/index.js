import{B as te}from"./chunks/false.js";import{json as J,text as z,error as ve}from"@sveltejs/kit";import{HttpError as ne,SvelteKitError as L,Redirect as B,ActionFailure as be}from"@sveltejs/kit/internal";import{with_request_store as N,merge_tracing as oe}from"@sveltejs/kit/internal/server";import{a as V,b as U,c as se,r as Ft,o as Gt,d as Be}from"./chunks/server.js";import*as I from"devalue";import{m as Bt,d as ft,a as pt,r as Jt,w as Je,v as Vt,b as Xt,c as Kt,e as Yt,n as Ue,f as Ve,g as Qt}from"./chunks/exports.js";import{b as Xe,t as Zt,a as fe,g as er}from"./chunks/utils.js";import{p as Te,r as Ke,o as tr,s as rr,a as nr,g as sr,b as ar}from"./chunks/internal.js";import{c as or,p as _e,s as ce,T as Ye,I as Qe}from"./chunks/shared.js";import{parse as me,serialize as Ae}from"cookie";import*as Ze from"set-cookie-parser";function ht(){let e,t;return{promise:new Promise((n,s)=>{e=n,t=s}),resolve:e,reject:t}}const ir=[101,103,204,205,304],cr=!!globalThis.process?.versions?.webcontainer,lr="/_svelte_kit_assets",_t=["GET","POST","PUT","PATCH","DELETE","OPTIONS","HEAD"],dr=["GET","POST","HEAD"];function Ne(e,t){const r=[];e.split(",").forEach((a,o)=>{const i=/([^/ \t]+)\/([^; \t]+)[ \t]*(?:;[ \t]*q=([0-9.]+))?/.exec(a);if(i){const[,c,d,l="1"]=i;r.push({type:c,subtype:d,q:+l,i:o})}}),r.sort((a,o)=>a.q!==o.q?o.q-a.q:a.subtype==="*"!=(o.subtype==="*")?a.subtype==="*"?1:-1:a.type==="*"!=(o.type==="*")?a.type==="*"?1:-1:a.i-o.i);let n,s=1/0;for(const a of t){const[o,i]=a.split("/"),c=r.findIndex(d=>(d.type===o||d.type==="*")&&(d.subtype===i||d.subtype==="*"));c!==-1&&c<s&&(n=a,s=c)}return n}function ur(e,...t){const r=e.headers.get("content-type")?.split(";",1)[0].trim()??"";return t.includes(r.toLowerCase())}function He(e){return ur(e,"application/x-www-form-urlencoded","multipart/form-data","text/plain")}function fr(e){return e instanceof Error||e&&e.name&&e.message?e:new Error(JSON.stringify(e))}function ae(e){return e instanceof ne||e instanceof L?e.status:500}function pr(e){return e instanceof L?e.text:"Internal Error"}const mt={"&":"&amp;",'"':"&quot;"},yt={"&":"&amp;","<":"&lt;"},gt="[\\ud800-\\udbff](?![\\udc00-\\udfff])|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\udc00-\\udfff]",hr=new RegExp(`[${Object.keys(mt).join("")}]|`+gt,"g"),_r=new RegExp(`[${Object.keys(yt).join("")}]|`+gt,"g");function Ie(e,t){const r=t?mt:yt;return e.replace(t?hr:_r,s=>s.length===2?s:r[s]??`&#${s.charCodeAt(0)};`)}function wt(e,t){return z(`${t} method not allowed`,{status:405,headers:{allow:mr(e).join(", ")}})}function mr(e){const t=_t.filter(r=>r in e);return"GET"in e&&!("HEAD"in e)&&t.push("HEAD"),t}function bt(e){return`__sveltekit_${e.version_hash}`}function ye(e,t,r){let n=e.templates.error({status:t,message:Ie(r)});return z(n,{headers:{"content-type":"text/html; charset=utf-8"},status:t})}async function et(e,t,r,n){n=n instanceof ne?n:fr(n);const s=ae(n),a=await D(e,t,r,n),o=Ne(e.request.headers.get("accept")||"text/html",["application/json","text/html"]);return e.isDataRequest||o==="application/json"?J(a,{status:s}):ye(r,s,a.message)}async function D(e,t,r,n){if(n instanceof ne)return{message:"Unknown Error",...n.body};const s=ae(n),a=pr(n);return await N({event:e,state:t},()=>r.hooks.handleError({error:n,event:e,status:s,message:a}))??{message:a}}function ge(e,t){return new Response(void 0,{status:e,headers:{location:t}})}function kt(e,t){return t.path?`Data returned from \`load\` while rendering ${e.route.id} is not serializable: ${t.message} (${t.path}). If you need to serialize/deserialize custom types, use transport hooks: https://svelte.dev/docs/kit/hooks#Universal-hooks-transport.`:t.path===""?`Data returned from \`load\` while rendering ${e.route.id} is not a plain object`:t.message}function $t(e){const t={};return e.uses&&e.uses.dependencies.size>0&&(t.dependencies=Array.from(e.uses.dependencies)),e.uses&&e.uses.search_params.size>0&&(t.search_params=Array.from(e.uses.search_params)),e.uses&&e.uses.params.size>0&&(t.params=Array.from(e.uses.params)),e.uses?.parent&&(t.parent=1),e.uses?.route&&(t.route=1),e.uses?.url&&(t.url=1),t}function vt(e,t){return e._.prerendered_routes.has(t)||t.at(-1)==="/"&&e._.prerendered_routes.has(t.slice(0,-1))}function yr(e,t,r){const n=`
\x1B[1;31m[${e}] ${r.request.method} ${r.url.pathname}\x1B[0m`;return e===404?n:`${n}
${t.stack}`}function xt(e){const r=e?.split("/")?.at(-1);return r?r.split(".").slice(0,-1).join("."):"unknown"}async function gr(e,t,r,n){const s=e.request.method;let a=r[s]||r.fallback;if(s==="HEAD"&&!r.HEAD&&r.GET&&(a=r.GET),!a)return wt(r,s);const o=r.prerender??n.prerender_default;if(o&&(r.POST||r.PATCH||r.PUT||r.DELETE))throw new Error("Cannot prerender endpoints that have mutative methods");if(n.prerendering&&!n.prerendering.inside_reroute&&!o){if(n.depth>0)throw new Error(`${e.route.id} is not prerenderable`);return new Response(void 0,{status:204})}t.is_endpoint_request=!0;try{const i=await N({event:e,state:t},()=>a(e));if(!(i instanceof Response))throw new Error(`Invalid response from route ${e.url.pathname}: handler should return a Response object`);if(n.prerendering&&(!n.prerendering.inside_reroute||o)){const c=new Response(i.clone().body,{status:i.status,statusText:i.statusText,headers:new Headers(i.headers)});if(c.headers.set("x-sveltekit-prerender",String(o)),n.prerendering.inside_reroute&&o)c.headers.set("x-sveltekit-routeid",encodeURI(e.route.id)),n.prerendering.dependencies.set(e.url.pathname,{response:c,body:null});else return c}return i}catch(i){if(i instanceof B)return new Response(void 0,{status:i.status,headers:{location:i.location}});throw i}}function wr(e){const{method:t,headers:r}=e.request;if(_t.includes(t)&&!dr.includes(t))return!0;if(t==="POST"&&r.get("x-sveltekit-action")==="true")return!1;const n=e.request.headers.get("accept")??"*/*";return Ne(n,["*","text/html"])!=="text/html"}function Oe(e){return e.filter(t=>t!=null)}const Le="/__data.json",we=".html__data.json";function br(e){return e.endsWith(Le)||e.endsWith(we)}function De(e){return e.endsWith(".html")?e.replace(/\.html$/,we):e.replace(/\/$/,"")+Le}function kr(e){return e.endsWith(we)?e.slice(0,-we.length)+".html":e.slice(0,-Le.length)}const We="/__route.js";function $r(e){return e.endsWith(We)}function Et(e){return e.replace(/\/$/,"")+We}function vr(e){return e.slice(0,-We.length)}const xr={spanContext(){return Er},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this},addLink(){return this},addLinks(){return this}},Er={traceId:"",spanId:"",traceFlags:0};async function ee({name:e,attributes:t,fn:r}){return r(xr)}function Rt(e){return Ne(e.request.headers.get("accept")??"*/*",["application/json","text/html"])==="application/json"&&e.request.method==="POST"}async function Rr(e,t,r,n){const s=n?.actions;if(!s){const a=new L(405,"Method Not Allowed","POST method not allowed. No form actions exist for this page");return le({type:"error",error:await D(e,t,r,a)},{status:a.status,headers:{allow:"GET"}})}St(s);try{const a=await Tt(e,t,s);return a instanceof be?le({type:"failure",status:a.status,data:tt(a.data,e.route.id,r.hooks.transport)}):le({type:"success",status:a?200:204,data:tt(a,e.route.id,r.hooks.transport)})}catch(a){const o=a;return o instanceof B?jt(o):le({type:"error",error:await D(e,t,r,Me(o))},{status:ae(o)})}}function Me(e){return e instanceof be?new Error('Cannot "throw fail()". Use "return fail()"'):e}function jt(e){return le({type:"redirect",status:e.status,location:e.location})}function le(e,t){return J(e,t)}function jr(e){return e.request.method==="POST"}async function Sr(e,t,r){const n=r?.actions;if(!n)return e.setHeaders({allow:"GET"}),{type:"error",error:new L(405,"Method Not Allowed","POST method not allowed. No form actions exist for this page")};St(n);try{const s=await Tt(e,t,n);return s instanceof be?{type:"failure",status:s.status,data:s.data}:{type:"success",status:200,data:s}}catch(s){const a=s;return a instanceof B?{type:"redirect",status:a.status,location:a.location}:{type:"error",error:Me(a)}}}function St(e){if(e.default&&Object.keys(e).length>1)throw new Error("When using named actions, the default action cannot be used. See the docs for more info: https://svelte.dev/docs/kit/form-actions#named-actions")}async function Tt(e,t,r){const n=new URL(e.request.url);let s="default";for(const o of n.searchParams)if(o[0].startsWith("/")){if(s=o[0].slice(1),s==="default")throw new Error('Cannot use reserved action name "default"');break}const a=r[s];if(!a)throw new L(404,"Not Found",`No action with name '${s}' found`);if(!He(e.request))throw new L(415,"Unsupported Media Type",`Form actions expect form-encoded data — received ${e.request.headers.get("content-type")}`);return ee({name:"sveltekit.form_action",attributes:{"http.route":e.route.id||"unknown"},fn:async o=>{const i=oe(e,o),c=await N({event:i,state:t},()=>a(i));return c instanceof be&&o.setAttributes({"sveltekit.form_action.result.type":"failure","sveltekit.form_action.result.status":c.status}),c}})}function Tr(e,t,r){const n=s=>{for(const a in r){const o=r[a].encode(s);if(o)return`app.decode('${a}', ${I.uneval(o,n)})`}};return At(e,s=>I.uneval(s,n),t)}function tt(e,t,r){const n=Object.fromEntries(Object.entries(r).map(([s,a])=>[s,a.encode]));return At(e,s=>I.stringify(s,n),t)}function At(e,t,r){try{return t(e)}catch(n){const s=n;if(e instanceof Response)throw new Error(`Data returned from action inside ${r} is not serializable. Form actions need to return plain objects or fail(). E.g. return { success: true } or return fail(400, { message: "invalid" });`);if("path"in s){let a=`Data returned from action inside ${r} is not serializable: ${s.message}`;throw s.path!==""&&(a+=` (data.${s.path})`),new Error(a)}throw s}}function Ot(){let e=-1,t=-1;const r=[];return{iterate:(n=s=>s)=>({[Symbol.asyncIterator](){return{next:async()=>{const s=r[++t];if(!s)return{value:null,done:!0};const a=await s.promise;return{value:n(a),done:!1}}}}}),add:n=>{r.push(ht()),n.then(s=>{r[++e].resolve(s)})}}}function de(e,t,r){let n=1,s=-1;const a=Ot(),o=bt(r);function i(d){return function l(h){if(typeof h?.then=="function"){const b=n++,p=h.then(f=>({data:f})).catch(async f=>({error:await D(e,t,r,f)})).then(async({data:f,error:u})=>{let _;try{_=I.uneval(u?[,u]:[f],l)}catch{u=await D(e,t,r,new Error(`Failed to serialize promise while rendering ${e.route.id}`)),f=void 0,_=I.uneval([,u],l)}return{index:d,str:`${o}.resolve(${b}, ${_.includes("app.decode")?`(app) => ${_}`:`() => ${_}`})`}});return a.add(p),`${o}.defer(${b})`}else for(const b in r.hooks.transport){const p=r.hooks.transport[b].encode(h);if(p)return`app.decode('${b}', ${I.uneval(p,l)})`}}}const c=[];return{set_max_nodes(d){s=d},add_node(d,l){try{if(!l){c[d]="null";return}const h={type:"data",data:l.data,uses:$t(l)};l.slash&&(h.slash=l.slash),c[d]=I.uneval(h,i(d))}catch(h){throw h.path=h.path.slice(1),new Error(kt(e,h))}},get_data(d){const l=`<script${d.script_needs_nonce?` nonce="${d.nonce}"`:""}>`,h=`<\/script>
`;return{data:`[${Oe(s>-1?c.slice(0,s):c).join(",")}]`,chunks:n>1?a.iterate(({index:b,str:p})=>s>-1&&b>=s?"":l+p+h):null}}}}function qt(e,t,r){let n=1;const s=Ot(),a={...Object.fromEntries(Object.entries(r.hooks.transport).map(([i,c])=>[i,c.encode])),Promise:i=>{if(typeof i?.then!="function")return;const c=n++;let d="data";const l=i.catch(async h=>(d="error",D(e,t,r,h))).then(async h=>{let b;try{b=I.stringify(h,a)}catch{const p=await D(e,t,r,new Error(`Failed to serialize promise while rendering ${e.route.id}`));d="error",b=I.stringify(p,a)}return`{"type":"chunk","id":${c},"${d}":${b}}
`});return s.add(l),c}},o=[];return{add_node(i,c){try{if(!c){o[i]="null";return}if(c.type==="error"||c.type==="skip"){o[i]=JSON.stringify(c);return}o[i]=`{"type":"data","data":${I.stringify(c.data,a)},"uses":${JSON.stringify($t(c))}${c.slash?`,"slash":${JSON.stringify(c.slash)}`:""}}`}catch(d){throw d.path="data"+d.path,new Error(kt(e,d))}},get_data(){return{data:`{"type":"data","nodes":[${o.join(",")}]}
`,chunks:n>1?s.iterate():null}}}}async function Fe({event:e,event_state:t,state:r,node:n,parent:s}){if(!n?.server)return null;let a=!0;const o={dependencies:new Set,params:new Set,parent:!1,route:!1,url:!1,search_params:new Set},i=n.server.load,c=n.server.trailingSlash;if(!i)return{type:"data",data:null,uses:o,slash:c};const d=Bt(e.url,()=>{a&&(o.url=!0)},h=>{a&&o.search_params.add(h)});return r.prerendering&&ft(d),{type:"data",data:await ee({name:"sveltekit.load",attributes:{"sveltekit.load.node_id":n.server_id||"unknown","sveltekit.load.node_type":xt(n.server_id),"http.route":e.route.id||"unknown"},fn:async h=>{const b=oe(e,h);return await N({event:b,state:t},()=>i.call(null,{...b,fetch:(f,u)=>(new URL(f instanceof Request?f.url:f,e.url),e.fetch(f,u)),depends:(...f)=>{for(const u of f){const{href:_}=new URL(u,e.url);o.dependencies.add(_)}},params:new Proxy(e.params,{get:(f,u)=>(a&&o.params.add(u),f[u])}),parent:async()=>(a&&(o.parent=!0),s()),route:new Proxy(e.route,{get:(f,u)=>(a&&(o.route=!0),f[u])}),url:d,untrack(f){a=!1;try{return f()}finally{a=!0}}}))}})??null,uses:o,slash:c}}async function Pt({event:e,event_state:t,fetched:r,node:n,parent:s,server_data_promise:a,state:o,resolve_opts:i,csr:c}){const d=await a,l=n?.universal?.load;return l?await ee({name:"sveltekit.load",attributes:{"sveltekit.load.node_id":n.universal_id||"unknown","sveltekit.load.node_type":xt(n.universal_id),"http.route":e.route.id||"unknown"},fn:async b=>{const p=oe(e,b);return await N({event:p,state:t},()=>l.call(null,{url:e.url,params:e.params,data:d?.data??null,route:e.route,fetch:Ar(e,o,r,c,i),setHeaders:e.setHeaders,depends:()=>{},parent:s,untrack:f=>f(),tracing:p.tracing}))}})??null:d?.data??null}function Ar(e,t,r,n,s){const a=async(o,i)=>{const c=o instanceof Request&&o.body?o.clone().body:null,d=o instanceof Request&&[...o.headers].length?new Headers(o.headers):i?.headers;let l=await e.fetch(o,i);const h=new URL(o instanceof Request?o.url:o,e.url),b=h.origin===e.url.origin;let p;if(b)t.prerendering&&(p={response:l,body:null},t.prerendering.dependencies.set(h.pathname,p));else if(h.protocol==="https:"||h.protocol==="http:")if((o instanceof Request?o.mode:i?.mode??"cors")==="no-cors")l=new Response("",{status:l.status,statusText:l.statusText,headers:l.headers});else{const y=l.headers.get("access-control-allow-origin");if(!y||y!==e.url.origin&&y!=="*")throw new Error(`CORS error: ${y?"Incorrect":"No"} 'Access-Control-Allow-Origin' header is present on the requested resource`)}let f;const u=new Proxy(l,{get(_,y,$){async function j(x,m){const g=Number(_.status);if(isNaN(g))throw new Error(`response.status is not a number. value: "${_.status}" type: ${typeof _.status}`);r.push({url:b?h.href.slice(e.url.origin.length):h.href,method:e.request.method,request_body:o instanceof Request&&c?await Or(c):i?.body,request_headers:d,response_body:x,response:_,is_b64:m})}if(y==="body"){if(_.body===null)return null;if(f)return f;const[x,m]=_.body.tee();return(async()=>{let g=new Uint8Array;for await(const w of x){const k=new Uint8Array(g.length+w.length);k.set(g,0),k.set(w,g.length),g=k}p&&(p.body=new Uint8Array(g)),j(Xe(g),!0)})(),f=m}if(y==="arrayBuffer")return async()=>{const x=await _.arrayBuffer(),m=new Uint8Array(x);return p&&(p.body=m),x instanceof ArrayBuffer&&await j(Xe(m),!0),x};async function v(){const x=await _.text();if(x===""&&ir.includes(_.status)){await j(void 0,!1);return}return(!x||typeof x=="string")&&await j(x,!1),p&&(p.body=x),x}return y==="text"?v:y==="json"?async()=>{const x=await v();return x?JSON.parse(x):void 0}:Reflect.get(_,y,_)}});if(n){const _=l.headers.get;l.headers.get=y=>{const $=y.toLowerCase(),j=_.call(l.headers,$);if(j&&!$.startsWith("x-sveltekit-")&&!s.filterSerializedResponseHeaders($,j))throw new Error(`Failed to get response header "${$}" — it must be included by the \`filterSerializedResponseHeaders\` option: https://svelte.dev/docs/kit/hooks#Server-hooks-handle (at ${e.route.id})`);return j}}return u};return(o,i)=>{const c=a(o,i);return c.catch(()=>{}),c}}async function Or(e){let t="";const r=e.getReader();for(;;){const{done:n,value:s}=await r.read();if(n)break;t+=Zt.decode(s)}return t}function Ct(...e){let t=5381;for(const r of e)if(typeof r=="string"){let n=r.length;for(;n;)t=t*33^r.charCodeAt(--n)}else if(ArrayBuffer.isView(r)){const n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);let s=n.length;for(;s;)t=t*33^n[--s]}else throw new TypeError("value must be a string or TypedArray");return(t>>>0).toString(36)}const zt={"<":"\\u003C","\u2028":"\\u2028","\u2029":"\\u2029"},qr=new RegExp(`[${Object.keys(zt).join("")}]`,"g");function Pr(e,t,r=!1){const n={};let s=null,a=null,o=!1;for(const[l,h]of e.response.headers)t(l,h)&&(n[l]=h),l==="cache-control"?s=h:l==="age"?a=h:l==="vary"&&h.trim()==="*"&&(o=!0);const i={status:e.response.status,statusText:e.response.statusText,headers:n,body:e.response_body},c=JSON.stringify(i).replace(qr,l=>zt[l]),d=['type="application/json"',"data-sveltekit-fetched",`data-url="${Ie(e.url,!0)}"`];if(e.is_b64&&d.push("data-b64"),e.request_headers||e.request_body){const l=[];e.request_headers&&l.push([...new Headers(e.request_headers)].join(",")),e.request_body&&l.push(e.request_body),d.push(`data-hash="${Ct(...l)}"`)}if(!r&&e.method==="GET"&&s&&!o){const l=/s-maxage=(\d+)/g.exec(s)??/max-age=(\d+)/g.exec(s);if(l){const h=+l[1]-+(a??"0");d.push(`data-ttl="${h}"`)}}return`<script ${d.join(" ")}>${c}<\/script>`}const H=JSON.stringify;function rt(e){qe[0]||Cr();const t=Ut.slice(0),r=zr(e);for(let s=0;s<r.length;s+=16){const a=r.subarray(s,s+16);let o,i,c,d=t[0],l=t[1],h=t[2],b=t[3],p=t[4],f=t[5],u=t[6],_=t[7];for(let y=0;y<64;y++)y<16?o=a[y]:(i=a[y+1&15],c=a[y+14&15],o=a[y&15]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(c>>>17^c>>>19^c>>>10^c<<15^c<<13)+a[y&15]+a[y+9&15]|0),o=o+_+(p>>>6^p>>>11^p>>>25^p<<26^p<<21^p<<7)+(u^p&(f^u))+qe[y],_=u,u=f,f=p,p=b+o|0,b=h,h=l,l=d,d=o+(l&h^b&(l^h))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;t[0]=t[0]+d|0,t[1]=t[1]+l|0,t[2]=t[2]+h|0,t[3]=t[3]+b|0,t[4]=t[4]+p|0,t[5]=t[5]+f|0,t[6]=t[6]+u|0,t[7]=t[7]+_|0}const n=new Uint8Array(t.buffer);return Nt(n),btoa(String.fromCharCode(...n))}const Ut=new Uint32Array(8),qe=new Uint32Array(64);function Cr(){function e(r){return(r-Math.floor(r))*4294967296}let t=2;for(let r=0;r<64;t++){let n=!0;for(let s=2;s*s<=t;s++)if(t%s===0){n=!1;break}n&&(r<8&&(Ut[r]=e(t**(1/2))),qe[r]=e(t**(1/3)),r++)}}function Nt(e){for(let t=0;t<e.length;t+=4){const r=e[t+0],n=e[t+1],s=e[t+2],a=e[t+3];e[t+0]=a,e[t+1]=s,e[t+2]=n,e[t+3]=r}}function zr(e){const t=fe.encode(e),r=t.length*8,n=512*Math.ceil((r+65)/512),s=new Uint8Array(n/8);s.set(t),s[t.length]=128,Nt(s);const a=new Uint32Array(s.buffer);return a[a.length-2]=Math.floor(r/4294967296),a[a.length-1]=r,a}const nt=new Uint8Array(16);function Ur(){return crypto.getRandomValues(nt),btoa(String.fromCharCode(...nt))}const Nr=new Set(["self","unsafe-eval","unsafe-hashes","unsafe-inline","none","strict-dynamic","report-sample","wasm-unsafe-eval","script"]),Hr=/^(nonce|sha\d\d\d)-/;class Ht{#e;#t;#c;#l;#d;#u;#f;#p;#n;#s;#a;#o;#i;#r;#h;constructor(t,r,n){this.#e=t,this.#n=r;const s=this.#n;this.#s=[],this.#a=[],this.#o=[],this.#i=[],this.#r=[];const a=s["script-src"]||s["default-src"],o=s["script-src-elem"],i=s["style-src"]||s["default-src"],c=s["style-src-attr"],d=s["style-src-elem"],l=h=>!!h&&!h.some(b=>b==="unsafe-inline");this.#c=l(a),this.#l=l(o),this.#u=l(i),this.#f=l(c),this.#p=l(d),this.#t=this.#c||this.#l,this.#d=this.#u||this.#f||this.#p,this.script_needs_nonce=this.#t&&!this.#e,this.style_needs_nonce=this.#d&&!this.#e,this.#h=n}add_script(t){if(!this.#t)return;const r=this.#e?`sha256-${rt(t)}`:`nonce-${this.#h}`;this.#c&&this.#s.push(r),this.#l&&this.#a.push(r)}add_style(t){if(!this.#d)return;const r=this.#e?`sha256-${rt(t)}`:`nonce-${this.#h}`;if(this.#u&&this.#o.push(r),this.#f&&this.#i.push(r),this.#p){const n="sha256-9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc=",s=this.#n;s["style-src-elem"]&&!s["style-src-elem"].includes(n)&&!this.#r.includes(n)&&this.#r.push(n),r!==n&&this.#r.push(r)}}get_header(t=!1){const r=[],n={...this.#n};this.#o.length>0&&(n["style-src"]=[...n["style-src"]||n["default-src"]||[],...this.#o]),this.#i.length>0&&(n["style-src-attr"]=[...n["style-src-attr"]||[],...this.#i]),this.#r.length>0&&(n["style-src-elem"]=[...n["style-src-elem"]||[],...this.#r]),this.#s.length>0&&(n["script-src"]=[...n["script-src"]||n["default-src"]||[],...this.#s]),this.#a.length>0&&(n["script-src-elem"]=[...n["script-src-elem"]||[],...this.#a]);for(const s in n){if(t&&(s==="frame-ancestors"||s==="report-uri"||s==="sandbox"))continue;const a=n[s];if(!a)continue;const o=[s];Array.isArray(a)&&a.forEach(i=>{Nr.has(i)||Hr.test(i)?o.push(`'${i}'`):o.push(i)}),r.push(o.join(" "))}return r.join("; ")}}class Ir extends Ht{get_meta(){const t=this.get_header(!0);if(t)return`<meta http-equiv="content-security-policy" content="${Ie(t,!0)}">`}}class Lr extends Ht{constructor(t,r,n){if(super(t,r,n),Object.values(r).filter(s=>!!s).length>0){const s=r["report-to"]?.length??!1,a=r["report-uri"]?.length??!1;if(!s&&!a)throw Error("`content-security-policy-report-only` must be specified with either the `report-to` or `report-uri` directives, or both")}}}class Dr{nonce=Ur();csp_provider;report_only_provider;constructor({mode:t,directives:r,reportOnly:n},{prerender:s}){const a=t==="hash"||t==="auto"&&s;this.csp_provider=new Ir(a,r,this.nonce),this.report_only_provider=new Lr(a,n,this.nonce)}get script_needs_nonce(){return this.csp_provider.script_needs_nonce||this.report_only_provider.script_needs_nonce}get style_needs_nonce(){return this.csp_provider.style_needs_nonce||this.report_only_provider.style_needs_nonce}add_script(t){this.csp_provider.add_script(t),this.report_only_provider.add_script(t)}add_style(t){this.csp_provider.add_style(t),this.report_only_provider.add_style(t)}}function It(e,t,r){const n={},s=e.slice(1),a=s.filter(i=>i!==void 0);let o=0;for(let i=0;i<t.length;i+=1){const c=t[i];let d=s[i-o];if(c.chained&&c.rest&&o&&(d=s.slice(i-o,i+1).filter(l=>l).join("/"),o=0),d===void 0){c.rest&&(n[c.name]="");continue}if(!c.matcher||r[c.matcher](d)){n[c.name]=d;const l=t[i+1],h=s[i+1];l&&!l.rest&&l.optional&&h&&c.chained&&(o=0),!l&&!h&&Object.keys(n).length===a.length&&(o=0);continue}if(c.optional&&c.chained){o++;continue}return}if(!o)return n}function Lt(e,t,r){const{errors:n,layouts:s,leaf:a}=e,o=[...n,...s.map(i=>i?.[1]),a[1]].filter(i=>typeof i=="number").map(i=>`'${i}': () => ${Dt(r._.client.nodes?.[i],t)}`).join(`,
		`);return[`{
	id: ${H(e.id)}`,`errors: ${H(e.errors)}`,`layouts: ${H(e.layouts)}`,`leaf: ${H(e.leaf)}`,`nodes: {
		${o}
	}
}`].join(`,
	`)}function Dt(e,t){if(!e)return"Promise.resolve({})";if(e[0]==="/")return`import('${e}')`;if(V!=="")return`import('${V}/${e}')`;let r=er(t.pathname,`${U}/${e}`);return r[0]!=="."&&(r=`./${r}`),`import('${r}')`}async function Wr(e,t,r){if(!r._.client.routes)return z("Server-side route resolution disabled",{status:400});let n=null,s={};const a=await r._.matchers();for(const o of r._.client.routes){const i=o.pattern.exec(e);if(!i)continue;const c=It(i,o.params,a);if(c){n=o,s=pt(c);break}}return Wt(n,s,t,r).response}function Wt(e,t,r,n){const s=new Headers({"content-type":"application/javascript; charset=utf-8"});if(e){const a=Lt(e,r,n),o=`${Mr(e,r,n)}
export const route = ${a}; export const params = ${JSON.stringify(t)};`;return{response:z(o,{headers:s}),body:o}}else return{response:z("",{headers:s}),body:""}}function Mr(e,t,r){const{errors:n,layouts:s,leaf:a}=e;let o="";for(const i of[...n,...s.map(c=>c?.[1]),a[1]]){if(typeof i!="number")continue;const c=r._.client.css?.[i];for(const d of c??[])o+=`'${V||U}/${d}',`}return o?`${Dt(r._.client.start,t)}.then(x => x.load_css([${o}]));`:""}const Fr={...Jt(!1),check:()=>!1};async function ue({branch:e,fetched:t,options:r,manifest:n,state:s,page_config:a,status:o,error:i=null,event:c,event_state:d,resolve_opts:l,action_result:h,data_serializer:b}){if(s.prerendering){if(r.csp.mode==="nonce")throw new Error('Cannot use prerendering if config.kit.csp.mode === "nonce"');if(r.app_template_contains_nonce)throw new Error("Cannot use prerendering if page template contains %sveltekit.nonce%")}const{client:p}=n._,f=new Set(p.imports),u=new Set(p.stylesheets),_=new Set(p.fonts),y=new Set,$=new Set,j=new Map;let v;const x=h?.type==="success"||h?.type==="failure"?h.data??null:null;let m=U,g=V,w=H(U);if(s.prerendering?.fallback?r.hash_routing&&(w="new URL('.', location).pathname.slice(0, -1)"):(m=c.url.pathname.slice(U.length).split("/").slice(2).map(()=>"..").join("/")||".",w=`new URL(${H(m)}, location).pathname.slice(0, -1)`,(!V||V[0]==="/"&&V!==lr)&&(g=m)),a.ssr){const S={stores:{page:Je(null),navigating:Je(null),updated:Fr},constructors:await Promise.all(e.map(({node:q})=>{if(!q.component)throw new Error(`Missing +page.svelte component for route ${c.route.id}`);return q.component()})),form:x};let A={};for(let q=0;q<e.length;q+=1)A={...A,...e[q].data},S[`data_${q}`]=A;S.page={error:i,params:c.params,route:c.route,status:o,url:c.url,data:A,form:x,state:{}};const G={context:new Map([["__request__",{page:S.page}]])},re=globalThis.fetch;try{v=await N({event:c,state:d},async()=>{Ft&&Gt({base:m,assets:g});const q=r.root.render(S,G),W=r.async&&"then"in q?q.then(O=>O):q;r.async&&Be();const{head:Q,html:pe,css:he}=r.async?await W:W;return{head:Q,html:pe,css:he}})}finally{Be()}for(const{node:q}of e){for(const W of q.imports)f.add(W);for(const W of q.stylesheets)u.add(W);for(const W of q.fonts)_.add(W);q.inline_styles&&!p.inline&&Object.entries(await q.inline_styles()).forEach(([W,Q])=>j.set(W,Q))}}else v={head:"",html:"",css:{code:"",map:null}};let k="",E=v.html;const R=new Dr(r.csp,{prerender:!!s.prerendering}),T=S=>S.startsWith("/")?U+S:`${g}/${S}`,P=p.inline?p.inline?.style:Array.from(j.values()).join(`
`);if(P){const S=[];R.style_needs_nonce&&S.push(` nonce="${R.nonce}"`),R.add_style(P),k+=`
	<style${S.join("")}>${P}</style>`}for(const S of u){const A=T(S),G=['rel="stylesheet"'];j.has(S)?G.push("disabled",'media="(max-width: 0)"'):l.preload({type:"css",path:A})&&y.add(`<${encodeURI(A)}>; rel="preload"; as="style"; nopush`),k+=`
		<link href="${A}" ${G.join(" ")}>`}for(const S of _){const A=T(S);if(l.preload({type:"font",path:A})){const G=S.slice(S.lastIndexOf(".")+1);$.add(`<link rel="preload" as="font" type="font/${G}" href="${A}" crossorigin>`),y.add(`<${encodeURI(A)}>; rel="preload"; as="font"; type="font/${G}"; crossorigin; nopush`)}}const M=bt(r),{data:F,chunks:X}=b.get_data(R);if(a.ssr&&a.csr&&(E+=`
			${t.map(S=>Pr(S,l.filterSerializedResponseHeaders,!!s.prerendering)).join(`
			`)}`),a.csr){const S=n._.client.routes?.find(O=>O.id===c.route.id)??null;if(p.uses_env_dynamic_public&&s.prerendering&&f.add(`${se}/env.js`),!p.inline){const O=Array.from(f,C=>T(C)).filter(C=>l.preload({type:"js",path:C}));for(const C of O)y.add(`<${encodeURI(C)}>; rel="modulepreload"; nopush`),r.preload_strategy!=="modulepreload"?k+=`
		<link rel="preload" as="script" crossorigin="anonymous" href="${C}">`:$.add(`<link rel="modulepreload" href="${C}">`)}if(s.prerendering&&$.size>0&&(k+=Array.from($).map(O=>`
		${O}`).join("")),n._.client.routes&&s.prerendering&&!s.prerendering.fallback){const O=Et(c.url.pathname);s.prerendering.dependencies.set(O,Wt(S,c.params,new URL(O,c.url),n))}const A=[],G=p.uses_env_dynamic_public&&s.prerendering,re=[`base: ${w}`];if(V&&re.push(`assets: ${H(V)}`),p.uses_env_dynamic_public&&re.push(`env: ${G?"null":H(Te)}`),X){A.push("const deferred = new Map();"),re.push(`defer: (id) => new Promise((fulfil, reject) => {
							deferred.set(id, { fulfil, reject });
						})`);let O="";Object.keys(r.hooks.transport).length>0&&(p.inline?O=`const app = __sveltekit_${r.version_hash}.app.app;`:p.app?O=`const app = await import(${H(T(p.app))});`:O=`const { app } = await import(${H(T(p.start))});`);const C=O?`${O}
							const [data, error] = fn(app);`:"const [data, error] = fn();";re.push(`resolve: async (id, fn) => {
							${C}

							const try_to_resolve = () => {
								if (!deferred.has(id)) {
									setTimeout(try_to_resolve, 0);
									return;
								}
								const { fulfil, reject } = deferred.get(id);
								deferred.delete(id);
								if (error) reject(error);
								else fulfil(data);
							}
							try_to_resolve();
						}`)}A.push(`${M} = {
						${re.join(`,
						`)}
					};`);const q=["element"];if(A.push("const element = document.currentScript.parentElement;"),a.ssr){const O={form:"null",error:"null"};x&&(O.form=Tr(x,c.route.id,r.hooks.transport)),i&&(O.error=I.uneval(i));const C=[`node_ids: [${e.map(({node:Y})=>Y.index).join(", ")}]`,`data: ${F}`,`form: ${O.form}`,`error: ${O.error}`];if(o!==200&&C.push(`status: ${o}`),n._.client.routes){if(S){const Y=Lt(S,c.url,n).replaceAll(`
`,`
							`);C.push(`params: ${I.uneval(c.params)}`,`server_route: ${Y}`)}}else r.embedded&&C.push(`params: ${I.uneval(c.params)}`,`route: ${H(c.route)}`);const Z="	".repeat(G?7:6);q.push(`{
${Z}	${C.join(`,
${Z}	`)}
${Z}}`)}const{remote_data:W}=d;let Q="";if(W){const O={};for(const[Z,Y]of W)if(Z.id)for(const ie in Y)O[or(Z.id,ie)]=await Y[ie];const C=Z=>{for(const Y in r.hooks.transport){const ie=r.hooks.transport[Y].encode(Z);if(ie)return`app.decode('${Y}', ${I.uneval(ie,C)})`}};Q=`${M}.data = ${I.uneval(O,C)};

						`}const pe=p.inline?`${p.inline.script}

					${Q}${M}.app.start(${q.join(", ")});`:p.app?`Promise.all([
						import(${H(T(p.start))}),
						import(${H(T(p.app))})
					]).then(([kit, app]) => {
						${Q}kit.start(app, ${q.join(", ")});
					});`:`import(${H(T(p.start))}).then((app) => {
						${Q}app.start(${q.join(", ")})
					});`;if(G?A.push(`import(${H(`${m}/${se}/env.js`)}).then(({ env }) => {
						${M}.env = env;

						${pe.replace(/\n/g,`
	`)}
					});`):A.push(pe),r.service_worker){let O="";if(r.service_worker_options!=null){const C={...r.service_worker_options};O=`, ${H(C)}`}A.push(`if ('serviceWorker' in navigator) {
						addEventListener('load', function () {
							navigator.serviceWorker.register('${T("service-worker.js")}'${O});
						});
					}`)}const he=`
				{
					${A.join(`

					`)}
				}
			`;R.add_script(he),E+=`
			<script${R.script_needs_nonce?` nonce="${R.nonce}"`:""}>${he}<\/script>
		`}const K=new Headers({"x-sveltekit-page":"true","content-type":"text/html"});if(s.prerendering){const S=[],A=R.csp_provider.get_meta();A&&S.push(A),s.prerendering.cache&&S.push(`<meta http-equiv="cache-control" content="${s.prerendering.cache}">`),S.length>0&&(k=S.join(`
`)+k)}else{const S=R.csp_provider.get_header();S&&K.set("content-security-policy",S);const A=R.report_only_provider.get_header();A&&K.set("content-security-policy-report-only",A),y.size&&K.set("link",Array.from(y).join(", "))}k+=v.head;const ke=r.templates.app({head:k,body:E,assets:g,nonce:R.nonce,env:Te}),$e=await l.transformPageChunk({html:ke,done:!0})||"";return X||K.set("etag",`"${Ct($e)}"`),X?new Response(new ReadableStream({async start(S){S.enqueue(fe.encode($e+`
`));for await(const A of X)A.length&&S.enqueue(fe.encode(A));S.close()},type:"bytes"}),{headers:K}):z($e,{status:o,headers:K})}class Ge{data;constructor(t){this.data=t}layouts(){return this.data.slice(0,-1)}page(){return this.data.at(-1)}validate(){for(const r of this.layouts())r&&(Vt(r.server,r.server_id),Xt(r.universal,r.universal_id));const t=this.page();t&&(Kt(t.server,t.server_id),Yt(t.universal,t.universal_id))}#e(t){return this.data.reduce((r,n)=>n?.universal?.[t]??n?.server?.[t]??r,void 0)}csr(){return this.#e("csr")??!0}ssr(){return this.#e("ssr")??!0}prerender(){return this.#e("prerender")??!1}trailing_slash(){return this.#e("trailingSlash")??"never"}get_config(){let t={};for(const r of this.data)!r?.universal?.config&&!r?.server?.config||(t={...t,...r?.universal?.config,...r?.server?.config});return Object.keys(t).length?t:void 0}should_prerender_data(){return this.data.some(t=>t?.server?.load||t?.server?.trailingSlash!==void 0)}}async function Mt({event:e,event_state:t,options:r,manifest:n,state:s,status:a,error:o,resolve_opts:i}){if(e.request.headers.get("x-sveltekit-error"))return ye(r,a,o.message);const c=[];try{const d=[],l=await n._.nodes[0](),h=new Ge([l]),b=h.ssr(),p=h.csr(),f=de(e,t,r);if(b){s.error=!0;const u=Fe({event:e,event_state:t,state:s,node:l,parent:async()=>({})}),_=await u;f.add_node(0,_);const y=await Pt({event:e,event_state:t,fetched:c,node:l,parent:async()=>({}),resolve_opts:i,server_data_promise:u,state:s,csr:p});d.push({node:l,server_data:_,data:y},{node:await n._.nodes[1](),data:null,server_data:null})}return await ue({options:r,manifest:n,state:s,page_config:{ssr:b,csr:p},status:a,error:await D(e,t,r,o),branch:d,fetched:c,event:e,event_state:t,resolve_opts:i,data_serializer:f})}catch(d){return d instanceof B?ge(d.status,d.location):ye(r,ae(d),(await D(e,t,r,d)).message)}}async function Gr(e,t,r,n,s){return ee({name:"sveltekit.remote.call",attributes:{},fn:a=>{const o=oe(e,a);return N({event:o,state:t},()=>Br(o,t,r,n,s))}})}async function Br(e,t,r,n,s){const[a,o,i]=s.split("/"),c=n._.remotes;c[a]||ve(404);const l=(await c[a]()).default[o];l||ve(404);const h=l.__,b=r.hooks.transport;e.tracing.current.setAttributes({"sveltekit.remote.call.type":h.type,"sveltekit.remote.call.name":h.name});let p;try{if(h.type==="query_batch"){if(e.request.method!=="POST")throw new L(405,"Method Not Allowed",`\`query.batch\` functions must be invoked via POST request, not ${e.request.method}`);const{payloads:y}=await e.request.json(),$=y.map(x=>_e(x,b)),j=await N({event:e,state:t},()=>h.run($)),v=await Promise.all($.map(async(x,m)=>{try{return{type:"result",data:j(x,m)}}catch(g){return{type:"error",error:await D(e,t,r,g),status:g instanceof ne||g instanceof L?g.status:500}}}));return J({type:"result",result:ce(v,b)})}if(h.type==="form"){if(e.request.method!=="POST")throw new L(405,"Method Not Allowed",`\`form\` functions must be invoked via POST request, not ${e.request.method}`);if(!He(e.request))throw new L(415,"Unsupported Media Type",`\`form\` functions expect form-encoded data — received ${e.request.headers.get("content-type")}`);const y=await e.request.formData();p=JSON.parse(y.get("sveltekit:remote_refreshes")??"[]"),y.delete("sveltekit:remote_refreshes"),i&&y.set("sveltekit:id",decodeURIComponent(i));const $=h.fn,j=await N({event:e,state:t},()=>$(y));return J({type:"result",result:ce(j,b),refreshes:j.issues?{}:await f(p)})}if(h.type==="command"){const{payload:y,refreshes:$}=await e.request.json(),j=_e(y,b),v=await N({event:e,state:t},()=>l(j));return J({type:"result",result:ce(v,b),refreshes:await f($)})}const u=h.type==="prerender"?i:new URL(e.request.url).searchParams.get("payload"),_=await N({event:e,state:t},()=>l(_e(u,b)));return J({type:"result",result:ce(_,b)})}catch(u){if(u instanceof B)return J({type:"redirect",location:u.location,refreshes:await f(p??[])});const _=u instanceof ne||u instanceof L?u.status:500;return J({type:"error",error:await D(e,t,r,u),status:_},{status:t.prerendering?_:void 0,headers:{"cache-control":"private, no-store"}})}async function f(u){const _=t.refreshes??{};for(const y of u){if(_[y]!==void 0)continue;const[$,j,v]=y.split("/"),x=n._.remotes[$],m=(await x?.())?.default?.[j];m||ve(400,"Bad Request"),_[y]=N({event:e,state:t},()=>m(_e(v,b)))}if(Object.keys(_).length!==0)return ce(Object.fromEntries(await Promise.all(Object.entries(_).map(async([y,$])=>[y,await $]))),b)}}async function Jr(e,t,r,n){return ee({name:"sveltekit.remote.form.post",attributes:{},fn:s=>{const a=oe(e,s);return N({event:a,state:t},()=>Vr(a,t,r,n))}})}async function Vr(e,t,r,n){const[s,a,o]=n.split("/");let d=(await r._.remotes[s]?.())?.default[a];if(!d)return e.setHeaders({allow:"GET"}),{type:"error",error:new L(405,"Method Not Allowed","POST method not allowed. No form actions exist for this page")};o&&(d=N({event:e,state:t},()=>d.for(JSON.parse(o))));try{const l=await e.request.formData(),h=d.__.fn;return o&&!l.has("id")&&l.set("sveltekit:id",decodeURIComponent(o)),await N({event:e,state:t},()=>h(l)),{type:"success",status:200}}catch(l){const h=l;return h instanceof B?{type:"redirect",status:h.status,location:h.location}:{type:"error",error:Me(h)}}}function Xr(e){return e.pathname.startsWith(`${U}/${se}/remote/`)&&e.pathname.replace(`${U}/${se}/remote/`,"")}function Kr(e){return e.searchParams.get("/remote")}const Yr=10;async function Qr(e,t,r,n,s,a,o,i){if(a.depth>Yr)return z(`Not found: ${e.url.pathname}`,{status:404});if(Rt(e)){const c=await s._.nodes[r.leaf]();return Rr(e,t,n,c?.server)}try{const c=o.page();let d=200,l;if(jr(e)){const g=Kr(e.url);if(g?l=await Jr(e,t,s,g):l=await Sr(e,t,c.server),l?.type==="redirect")return ge(l.status,l.location);l?.type==="error"&&(d=ae(l.error)),l?.type==="failure"&&(d=l.status)}const h=o.prerender();if(h){if(c.server?.actions)throw new Error("Cannot prerender pages with actions")}else if(a.prerendering)return new Response(void 0,{status:204});a.prerender_default=h;const b=o.should_prerender_data(),p=De(e.url.pathname),f=[],u=o.ssr(),_=o.csr();if(u===!1&&!(a.prerendering&&b))return te&&l&&e.request.headers.has("x-sveltekit-action"),await ue({branch:[],fetched:f,page_config:{ssr:!1,csr:_},status:d,error:null,event:e,event_state:t,options:n,manifest:s,state:a,resolve_opts:i,data_serializer:de(e,t,n)});const y=[];let $=null;const j=de(e,t,n),v=a.prerendering&&b?qt(e,t,n):null,x=o.data.map((g,w)=>{if($)throw $;return Promise.resolve().then(async()=>{try{if(g===c&&l?.type==="error")throw l.error;const k=await Fe({event:e,event_state:t,state:a,node:g,parent:async()=>{const E={};for(let R=0;R<w;R+=1){const T=await x[R];T&&Object.assign(E,T.data)}return E}});return g&&j.add_node(w,k),v?.add_node(w,k),k}catch(k){throw $=k,$}})}),m=o.data.map((g,w)=>{if($)throw $;return Promise.resolve().then(async()=>{try{return await Pt({event:e,event_state:t,fetched:f,node:g,parent:async()=>{const k={};for(let E=0;E<w;E+=1)Object.assign(k,await m[E]);return k},resolve_opts:i,server_data_promise:x[w],state:a,csr:_})}catch(k){throw $=k,$}})});for(const g of x)g.catch(()=>{});for(const g of m)g.catch(()=>{});for(let g=0;g<o.data.length;g+=1){const w=o.data[g];if(w)try{const k=await x[g],E=await m[g];y.push({node:w,server_data:k,data:E})}catch(k){const E=k;if(E instanceof B){if(a.prerendering&&b){const P=JSON.stringify({type:"redirect",location:E.location});a.prerendering.dependencies.set(p,{response:z(P),body:P})}return ge(E.status,E.location)}const R=ae(E),T=await D(e,t,n,E);for(;g--;)if(r.errors[g]){const P=r.errors[g],M=await s._.nodes[P]();let F=g;for(;!y[F];)F-=1;j.set_max_nodes(F+1);const X=Oe(y.slice(0,F+1)),K=new Ge(X.map(ke=>ke.node));return await ue({event:e,event_state:t,options:n,manifest:s,state:a,resolve_opts:i,page_config:{ssr:K.ssr(),csr:K.csr()},status:R,error:T,branch:X.concat({node:M,data:null,server_data:null}),fetched:f,data_serializer:j})}return ye(n,R,T.message)}else y.push(null)}if(a.prerendering&&v){let{data:g,chunks:w}=v.get_data();if(w)for await(const k of w)g+=k;a.prerendering.dependencies.set(p,{response:z(g),body:g})}return await ue({event:e,event_state:t,options:n,manifest:s,state:a,resolve_opts:i,page_config:{csr:_,ssr:u},status:d,error:null,branch:u===!1?[]:Oe(y),action_result:l,fetched:f,data_serializer:u===!1?de(e,t,n):j})}catch(c){return await Mt({event:e,event_state:t,options:n,manifest:s,state:a,status:500,error:c,resolve_opts:i})}}function Zr(e){let t=!1,r;return()=>t?r:(t=!0,r=e())}async function en(e,t,r,n,s,a,o,i){if(!r.page)return new Response(void 0,{status:404});try{const c=[...r.page.layouts,r.page.leaf],d=o??c.map(()=>!0);let l=!1;const h=new URL(e.url);h.pathname=Ue(h.pathname,i);const b={...e,url:h},p=c.map((v,x)=>Zr(async()=>{try{if(l)return{type:"skip"};const m=v==null?v:await s._.nodes[v]();return Fe({event:b,event_state:t,state:a,node:m,parent:async()=>{const g={};for(let w=0;w<x;w+=1){const k=await p[w]();k&&Object.assign(g,k.data)}return g}})}catch(m){throw l=!0,m}})),f=p.map(async(v,x)=>d[x]?v():{type:"skip"});let u=f.length;const _=await Promise.all(f.map((v,x)=>v.catch(async m=>{if(m instanceof B)throw m;return u=Math.min(u,x+1),{type:"error",error:await D(e,t,n,m),status:m instanceof ne||m instanceof L?m.status:void 0}}))),y=qt(e,t,n);for(let v=0;v<_.length;v++)y.add_node(v,_[v]);const{data:$,chunks:j}=y.get_data();return j?new Response(new ReadableStream({async start(v){v.enqueue(fe.encode($));for await(const x of j)v.enqueue(fe.encode(x));v.close()},type:"bytes"}),{headers:{"content-type":"text/sveltekit-data","cache-control":"private, no-store"}}):Pe($)}catch(c){const d=c;return d instanceof B?Ce(d):Pe(await D(e,t,n,d),500)}}function Pe(e,t=200){return z(typeof e=="string"?e:JSON.stringify(e),{status:t,headers:{"content-type":"application/json","cache-control":"private, no-store"}})}function Ce(e){return Pe({type:"redirect",location:e.location})}const tn=/[\x00-\x1F\x7F()<>@,;:"/[\]?={} \t]/;function xe(e){if(e?.path===void 0)throw new Error("You must specify a `path` when setting, deleting or serializing cookies")}function rn(e,t,r){return`${e||""}${t}?${encodeURIComponent(r)}`}function nn(e,t){const r=e.headers.get("cookie")??"",n=me(r,{decode:b=>b});let s;const a=new Map,o={httpOnly:!0,sameSite:"lax",secure:!(t.hostname==="localhost"&&t.protocol==="http:")},i={get(b,p){const f=Array.from(a.values()).filter(y=>y.name===b&&Ee(t.hostname,y.options.domain)&&Re(t.pathname,y.options.path)).sort((y,$)=>$.options.path.length-y.options.path.length)[0];return f?f.options.maxAge===0?void 0:f.value:me(r,{decode:p?.decode})[b]},getAll(b){const p=me(r,{decode:b?.decode}),f=new Map;for(const u of a.values())if(Ee(t.hostname,u.options.domain)&&Re(t.pathname,u.options.path)){const _=f.get(u.name);(!_||u.options.path.length>_.options.path.length)&&f.set(u.name,u)}for(const u of f.values())p[u.name]=u.value;return Object.entries(p).map(([u,_])=>({name:u,value:_}))},set(b,p,f){const u=b.match(tn);u&&console.warn(`The cookie name "${b}" will be invalid in SvelteKit 3.0 as it contains ${u.join(" and ")}. See RFC 2616 for more details https://datatracker.ietf.org/doc/html/rfc2616#section-2.2`),xe(f),l(b,p,{...o,...f})},delete(b,p){xe(p),i.set(b,"",{...p,maxAge:0})},serialize(b,p,f){xe(f);let u=f.path;if(!f.domain||f.domain===t.hostname){if(!s)throw new Error("Cannot serialize cookies until after the route is determined");u=Ve(s,u)}return Ae(b,p,{...o,...f,path:u})}};function c(b,p){const f={...n};for(const u of a.values()){if(!Ee(b.hostname,u.options.domain)||!Re(b.pathname,u.options.path))continue;const _=u.options.encode||encodeURIComponent;f[u.name]=_(u.value)}if(p){const u=me(p,{decode:_=>_});for(const _ in u)f[_]=u[_]}return Object.entries(f).map(([u,_])=>`${u}=${_}`).join("; ")}const d=[];function l(b,p,f){if(!s){d.push(()=>l(b,p,f));return}let u=f.path;(!f.domain||f.domain===t.hostname)&&(u=Ve(s,u));const _=rn(f.domain,u,b),y={name:b,value:p,options:{...f,path:u}};a.set(_,y)}function h(b){s=Ue(t.pathname,b),d.forEach(p=>p())}return{cookies:i,new_cookies:a,get_cookie_header:c,set_internal:l,set_trailing_slash:h}}function Ee(e,t){if(!t)return!0;const r=t[0]==="."?t.slice(1):t;return e===r?!0:e.endsWith("."+r)}function Re(e,t){if(!t)return!0;const r=t.endsWith("/")?t.slice(0,-1):t;return e===r?!0:e.startsWith(r+"/")}function st(e,t){for(const r of t){const{name:n,value:s,options:a}=r;if(e.append("set-cookie",Ae(n,s,a)),a.path.endsWith(".html")){const o=De(a.path);e.append("set-cookie",Ae(n,s,{...a,path:o}))}}}function sn({event:e,options:t,manifest:r,state:n,get_cookie_header:s,set_internal:a}){const o=async(i,c)=>{const d=at(i,c,e.url);let l=(i instanceof Request?i.mode:c?.mode)??"cors",h=(i instanceof Request?i.credentials:c?.credentials)??"same-origin";return t.hooks.handleFetch({event:e,request:d,fetch:async(b,p)=>{const f=at(b,p,e.url),u=new URL(f.url);if(f.headers.has("origin")||f.headers.set("origin",e.url.origin),b!==d&&(l=(b instanceof Request?b.mode:p?.mode)??"cors",h=(b instanceof Request?b.credentials:p?.credentials)??"same-origin"),(f.method==="GET"||f.method==="HEAD")&&(l==="no-cors"&&u.origin!==e.url.origin||u.origin===e.url.origin)&&f.headers.delete("origin"),u.origin!==e.url.origin){if(`.${u.hostname}`.endsWith(`.${e.url.hostname}`)&&h!=="omit"){const w=s(u,f.headers.get("cookie"));w&&f.headers.set("cookie",w)}return fetch(f)}const _=V||U,y=decodeURIComponent(u.pathname),$=(y.startsWith(_)?y.slice(_.length):y).slice(1),j=`${$}/index.html`,v=r.assets.has($)||$ in r._.server_assets,x=r.assets.has(j)||j in r._.server_assets;if(v||x){const w=v?$:j;if(n.read){const k=v?r.mimeTypes[$.slice($.lastIndexOf("."))]:"text/html";return new Response(n.read(w),{headers:k?{"content-type":k}:{}})}else if(Ke&&w in r._.server_assets){const k=r._.server_assets[w],E=r.mimeTypes[w.slice(w.lastIndexOf("."))];return new Response(Ke(w),{headers:{"Content-Length":""+k,"Content-Type":E}})}return await fetch(f)}if(vt(r,U+y))return await fetch(f);if(h!=="omit"){const w=s(u,f.headers.get("cookie"));w&&f.headers.set("cookie",w);const k=e.request.headers.get("authorization");k&&!f.headers.has("authorization")&&f.headers.set("authorization",k)}f.headers.has("accept")||f.headers.set("accept","*/*"),f.headers.has("accept-language")||f.headers.set("accept-language",e.request.headers.get("accept-language"));const m=await an(f,t,r,n),g=m.headers.get("set-cookie");if(g)for(const w of Ze.splitCookiesString(g)){const{name:k,value:E,...R}=Ze.parseString(w,{decodeValues:!1}),T=R.path??(u.pathname.split("/").slice(0,-1).join("/")||"/");a(k,E,{path:T,encode:P=>P,...R})}return m}})};return(i,c)=>{const d=o(i,c);return d.catch(()=>{}),d}}function at(e,t,r){return e instanceof Request?e:new Request(typeof e=="string"?new URL(e,r):e,t)}async function an(e,t,r,n){if(e.signal){if(e.signal.aborted)throw new DOMException("The operation was aborted.","AbortError");let s=()=>{};const a=new Promise((i,c)=>{const d=()=>{c(new DOMException("The operation was aborted.","AbortError"))};e.signal.addEventListener("abort",d,{once:!0}),s=()=>e.signal.removeEventListener("abort",d)}),o=await Promise.race([ze(e,t,r,{...n,depth:n.depth+1}),a]);return s(),o}else return await ze(e,t,r,{...n,depth:n.depth+1})}let ot,je,Se;function on(e){return ot??=`export const env=${JSON.stringify(Te)}`,je??=`W/${Date.now()}`,Se??=new Headers({"content-type":"application/javascript; charset=utf-8",etag:je}),e.headers.get("if-none-match")===je?new Response(void 0,{status:304,headers:Se}):new Response(ot,{headers:Se})}const it=({html:e})=>e,ct=()=>!1,lt=({type:e})=>e==="js"||e==="css",cn=new Set(["GET","HEAD","POST"]),ln=new Set(["GET","HEAD","OPTIONS"]);const ze=fn(dn);async function dn(e,t,r,n){const s=new URL(e.url),a=$r(s.pathname),o=br(s.pathname),i=Xr(s);{const m=e.headers.get("origin");if(i){if(e.method!=="GET"&&m!==s.origin)return J({message:"Cross-site remote requests are forbidden"},{status:403})}else if(t.csrf_check_origin&&He(e)&&(e.method==="POST"||e.method==="PUT"||e.method==="PATCH"||e.method==="DELETE")&&m!==s.origin&&(!m||!t.csrf_trusted_origins.includes(m))){const w=`Cross-site ${e.method} form submissions are forbidden`,k={status:403};return e.headers.get("accept")==="application/json"?J({message:w},k):z(w,k)}}if(t.hash_routing&&s.pathname!==U+"/"&&s.pathname!=="/[fallback]")return z("Not found",{status:404});let c;a?s.pathname=vr(s.pathname):o?(s.pathname=kr(s.pathname)+(s.searchParams.get(Ye)==="1"?"/":"")||"/",s.searchParams.delete(Ye),c=s.searchParams.get(Qe)?.split("").map(m=>m==="1"),s.searchParams.delete(Qe)):i&&(s.pathname=e.headers.get("x-sveltekit-pathname")??U,s.search=e.headers.get("x-sveltekit-search")??"");const d={},{cookies:l,new_cookies:h,get_cookie_header:b,set_internal:p,set_trailing_slash:f}=nn(e,s),u={prerendering:n.prerendering,transport:t.hooks.transport,handleValidationError:t.hooks.handleValidationError,tracing:{record_span:ee},is_in_remote_function:!1},_={cookies:l,fetch:null,getClientAddress:n.getClientAddress||(()=>{throw new Error("@sveltejs/adapter-static does not specify getClientAddress. Please raise an issue")}),locals:{},params:{},platform:n.platform,request:e,route:{id:null},setHeaders:m=>{for(const g in m){const w=g.toLowerCase(),k=m[g];if(w==="set-cookie")throw new Error("Use `event.cookies.set(name, value, options)` instead of `event.setHeaders` to set cookies");if(w in d)throw new Error(`"${g}" header is already set`);d[w]=k,n.prerendering&&w==="cache-control"&&(n.prerendering.cache=k)}},url:s,isDataRequest:o,isSubRequest:n.depth>0,isRemoteRequest:!!i};_.fetch=sn({event:_,options:t,manifest:r,state:n,get_cookie_header:b,set_internal:p}),n.emulator?.platform&&(_.platform=await n.emulator.platform({config:{},prerender:!!n.prerendering?.fallback}));let y=s.pathname;if(!i){const m=n.prerendering?.inside_reroute;try{n.prerendering&&(n.prerendering.inside_reroute=!0),y=await t.hooks.reroute({url:new URL(s),fetch:_.fetch})??s.pathname}catch{return z("Internal Server Error",{status:500})}finally{n.prerendering&&(n.prerendering.inside_reroute=m)}}try{y=Qt(y)}catch{return z("Malformed URI",{status:400})}if(y!==s.pathname&&!n.prerendering?.fallback&&vt(r,y)){const m=new URL(e.url);m.pathname=o?De(y):a?Et(y):y;const g=await fetch(m,e),w=new Headers(g.headers);return w.has("content-encoding")&&(w.delete("content-encoding"),w.delete("content-length")),new Response(g.body,{headers:w,status:g.status,statusText:g.statusText})}let $=null;if(U&&!n.prerendering?.fallback){if(!y.startsWith(U))return z("Not found",{status:404});y=y.slice(U.length)||"/"}if(a)return Wr(y,new URL(e.url),r);if(y===`/${se}/env.js`)return on(e);if(!i&&y.startsWith(`/${se}`)){const m=new Headers;return m.set("cache-control","public, max-age=0, must-revalidate"),z("Not found",{status:404,headers:m})}if(!n.prerendering?.fallback){const m=await r._.matchers();for(const g of r._.routes){const w=g.pattern.exec(y);if(!w)continue;const k=It(w,g.params,m);if(k){$=g,_.route={id:$.id},_.params=pt(k);break}}}let j={transformPageChunk:it,filterSerializedResponseHeaders:ct,preload:lt},v="never";try{const m=$?.page?new Ge(await un($.page,r)):void 0;if($&&!i){if(s.pathname===U||s.pathname===U+"/"?v="always":m?v=m.trailing_slash():$.endpoint&&(v=(await $.endpoint()).trailingSlash??"never"),!o){const w=Ue(s.pathname,v);if(w!==s.pathname&&!n.prerendering?.fallback)return new Response(void 0,{status:308,headers:{"x-sveltekit-normalize":"1",location:(w.startsWith("//")?s.origin+w:w)+(s.search==="?"?"":s.search)}})}if(n.before_handle||n.emulator?.platform){let w={},k=!1;if($.endpoint){const E=await $.endpoint();w=E.config??w,k=E.prerender??k}else m&&(w=m.get_config()??w,k=m.prerender());n.before_handle&&n.before_handle(_,w,k),n.emulator?.platform&&(_.platform=await n.emulator.platform({config:w,prerender:k}))}}f(v),n.prerendering&&!n.prerendering.fallback&&!n.prerendering.inside_reroute&&ft(s);const g=await ee({name:"sveltekit.handle.root",attributes:{"http.route":_.route.id||"unknown","http.method":_.request.method,"http.url":_.url.href,"sveltekit.is_data_request":o,"sveltekit.is_sub_request":_.isSubRequest},fn:async w=>{const k={..._,tracing:{enabled:!1,root:w,current:w}};return await N({event:k,state:u},()=>t.hooks.handle({event:k,resolve:(E,R)=>ee({name:"sveltekit.resolve",attributes:{"http.route":E.route.id||"unknown"},fn:T=>N(null,()=>x(oe(E,T),m,R).then(P=>{for(const M in d){const F=d[M];P.headers.set(M,F)}return st(P.headers,h.values()),n.prerendering&&E.route.id!==null&&P.headers.set("x-sveltekit-routeid",encodeURI(E.route.id)),T.setAttributes({"http.response.status_code":P.status,"http.response.body.size":P.headers.get("content-length")||"unknown"}),P}))})}))}});if(g.status===200&&g.headers.has("etag")){let w=e.headers.get("if-none-match");w?.startsWith('W/"')&&(w=w.substring(2));const k=g.headers.get("etag");if(w===k){const E=new Headers({etag:k});for(const R of["cache-control","content-location","date","expires","vary","set-cookie"]){const T=g.headers.get(R);T&&E.set(R,T)}return new Response(void 0,{status:304,headers:E})}}if(o&&g.status>=300&&g.status<=308){const w=g.headers.get("location");if(w)return Ce(new B(g.status,w))}return g}catch(m){if(m instanceof B){const g=o||i?Ce(m):$?.page&&Rt(_)?jt(m):ge(m.status,m.location);return st(g.headers,h.values()),g}return await et(_,u,t,m)}async function x(m,g,w){try{if(w&&(j={transformPageChunk:w.transformPageChunk||it,filterSerializedResponseHeaders:w.filterSerializedResponseHeaders||ct,preload:w.preload||lt}),t.hash_routing||n.prerendering?.fallback)return await ue({event:m,event_state:u,options:t,manifest:r,state:n,page_config:{ssr:!1,csr:!0},status:200,error:null,branch:[],fetched:[],resolve_opts:j,data_serializer:de(m,u,t)});if(i)return await Gr(m,u,t,r,i);if($){const E=m.request.method;let R;if(o)R=await en(m,u,$,t,r,n,c,v);else if($.endpoint&&(!$.page||wr(m)))R=await gr(m,u,await $.endpoint(),n);else if($.page)if(g)if(cn.has(E))R=await Qr(m,u,$.page,t,r,n,g,j);else{const T=new Set(ln);if((await r._.nodes[$.page.leaf]())?.server?.actions&&T.add("POST"),E==="OPTIONS")R=new Response(null,{status:204,headers:{allow:Array.from(T.values()).join(", ")}});else{const M=[...T].reduce((F,X)=>(F[X]=!0,F),{});R=wt(M,E)}}else throw new Error("page_nodes not found. This should never happen");else throw new Error("Route is neither page nor endpoint. This should never happen");if(e.method==="GET"&&$.page&&$.endpoint){const T=R.headers.get("vary")?.split(",")?.map(P=>P.trim().toLowerCase());T?.includes("accept")||T?.includes("*")||(R=new Response(R.body,{status:R.status,statusText:R.statusText,headers:new Headers(R.headers)}),R.headers.append("Vary","Accept"))}return R}if(n.error&&m.isSubRequest){const E=new Headers(e.headers);return E.set("x-sveltekit-error","true"),await fetch(e,{headers:E})}if(n.error)return z("Internal Server Error",{status:500});if(n.depth===0)return te&&m.url.pathname,await Mt({event:m,event_state:u,options:t,manifest:r,state:n,status:404,error:new L(404,"Not Found",`Not found: ${m.url.pathname}`),resolve_opts:j});if(n.prerendering)return z("not found",{status:404});const k=await fetch(e);return new Response(k.body,k)}catch(k){return await et(m,u,t,k)}finally{m.cookies.set=()=>{throw new Error("Cannot use `cookies.set(...)` after the response has been generated")},m.setHeaders=()=>{throw new Error("Cannot use `setHeaders(...)` after the response has been generated")}}}}function un(e,t){return Promise.all([...e.layouts.map(r=>r==null?r:t._.nodes[r]()),t._.nodes[e.leaf]()])}function fn(e){return async(t,...r)=>e(t,...r)}function dt(e,t,r){return Object.fromEntries(Object.entries(e).filter(([n])=>n.startsWith(t)&&(r===""||!n.startsWith(r))))}let pn,ut=null;class jn{#e;#t;constructor(t){if(this.#e=tr,this.#t=t,cr){const r=this.respond.bind(this);this.respond=async(...n)=>{const{promise:s,resolve:a}=ht(),o=ut;return ut=s,await o,r(...n).finally(a)}}}async init({env:t,read:r}){const{env_public_prefix:n,env_private_prefix:s}=this.#e;rr(dt(t,s,n)),nr(dt(t,n,s)),r&&ar(o=>{const i=r(o);return i instanceof ReadableStream?i:new ReadableStream({async start(c){try{const d=await Promise.resolve(i);if(!d){c.close();return}const l=d.getReader();for(;;){const{done:h,value:b}=await l.read();if(h)break;c.enqueue(b)}c.close()}catch(d){c.error(d)}}})}),await(pn??=(async()=>{try{const a=await sr();this.#e.hooks={handle:a.handle||(({event:o,resolve:i})=>i(o)),handleError:a.handleError||(({status:o,error:i,event:c})=>{const d=yr(o,i,c);console.error(d)}),handleFetch:a.handleFetch||(({request:o,fetch:i})=>i(o)),handleValidationError:a.handleValidationError||(({issues:o})=>(console.error("Remote function schema validation failed:",o),{message:"Bad Request"})),reroute:a.reroute||(()=>{}),transport:a.transport||{}},a.transport&&Object.fromEntries(Object.entries(a.transport).map(([o,i])=>[o,i.decode])),a.init&&await a.init()}catch(a){throw a}})())}async respond(t,r){return ze(t,this.#e,this.#t,{...r,error:!1,depth:0})}}export{jn as Server};
